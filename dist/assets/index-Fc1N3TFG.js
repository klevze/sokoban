var U=(a,e)=>()=>(e||a((e={exports:{}}).exports,e),e.exports);var be=U(T=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();const A={WIDTH:1e3,HEIGHT:800,BACKGROUND_COLOR:"#000000"},N={ANIMATION_SMOOTHNESS:20,KEY_THROTTLE_DELAY:150,MOVEMENT_SPEEDS:{SLOW:450,NORMAL:300,FAST:150,VERY_FAST:80},DEFAULT_SPEED:"NORMAL"},I={SOURCE_SIZE:96,OUTPUT_SIZE:40,PLAYER_SOURCE_SIZE:32,PLAYER_EXTRA_SIZE:10,WALKABLE_TILES:[10,17,18,19,20,71,72,73,74,81,82,83,84,88,89,90,22,23,24,25,32,33,34,35,42,43,44,45]},c={LOADING:"loading",INTRO:"intro",PLAY:"play",WIN:"win",PAUSED:"paused",LEVEL_SELECT:"level_select"},X={[c.LOADING]:[c.INTRO],[c.INTRO]:[c.PLAY,c.LEVEL_SELECT],[c.PLAY]:[c.WIN,c.PAUSED,c.INTRO],[c.WIN]:[c.PLAY,c.INTRO],[c.PAUSED]:[c.PLAY,c.INTRO],[c.LEVEL_SELECT]:[c.PLAY,c.INTRO]},M={IDLE_TIMEOUT:3e4,DIRECTION:{RIGHT:0,LEFT:1,DOWN:2,UP:3},ANIMATION:{WALKING_SPEED:40,FRAME_COUNT:4}},B={COUNT:130,SIZE:2,SPEED:64},G=a=>{const e={};for(const t in a)typeof a[t]=="string"?e[t]=a[t].startsWith("/")?a[t].replace("/","./"):a[t]:e[t]=G(a[t]);return e},v=G({LEVELS:"/assets/level/levels.json",IMAGES:{PLAYER:"/assets/images/players.png",TILES:"/assets/images/tileset_96x96px.png",LOGO:"/assets/images/logo.webp",MAIN_BG:"/assets/images/main.webp",BTN_PLAY:"/assets/images/btn_play.png",WOOD_PANEL:"/assets/images/wood_panel.webp",LEVEL_BG:"/assets/images/background_levels_wood.png",SCORE_LEVEL:"/assets/images/level_score_level.png",SCORE_MOVES:"/assets/images/level_score_moves.png",SCORE_PUSHES:"/assets/images/level_score_pushes.png",SCORE_TIME:"/assets/images/level_score_time.png",SCORE_BOXES:"/assets/images/level_score_boxes.png",ACTION_HOME:"/assets/images/top_action_home.png",ACTION_LEVEL:"/assets/images/top_action_level.png",ACTION_MUTE:"/assets/images/top_action_mute.png",ACTION_PAUSE:"/assets/images/top_action_pause.png",ACTION_RESTART:"/assets/images/top_action_restart.png"},SOUNDS:{MUSIC:"/assets/sound/Dreamcatcher.mp3",VICTORY:"/assets/sound/369252__funwithsound__victory-celebration-movie-score.wav",RUNNING:"/assets/sound/16_human_walk_stone_1.wav",PUSHING:"/assets/sound/04_sack_open_1.wav",BOXONGOAL:"/assets/sound/08_human_charge_1.wav",WHISTLE:"/assets/sound/mixkit-cartoon-whistling-738.wav"}}),E={ENABLED:!1,SHOW_TILE_NUMBERS:!1,SHOW_COORDINATES:!1,SHOW_GRID_LINES:!1},_="0.1.0",F=2025;class V{constructor(e,t,s,i=B.COUNT,o=B.SIZE,n=B.SPEED){this.starWidth=o,this.width=t,this.height=s,this.numStars=i,this.stars=new Array(i),this.ctx=e,this.depthFactor=128,this.angle=0,this.centerX=Math.floor(this.width/2),this.centerY=Math.floor(this.height/2),this.maxDepth=n,this.infinityPathTime=0,this.baseInfinityPathSpeed=.012,this.infinityPathSpeed=this.baseInfinityPathSpeed,this.speedVariationFactor=.8,this.speedCycleTime=0,this.speedCycleRate=.021,this.infinityPathWidth=250,this.infinityPathHeight=150,this.secondaryPathTime=0,this.secondaryPathSpeed=.001,this.secondaryPathScale=50,this.rotationDirection=-1,this.rotationSpeed=2,this.rotationCycleTime=0,this.rotationCycleRate=.005,this.starColors=["#fff","#aaa","#999","#777","#555","#444"],this.init()}createStar(){return{x:0,y:0,z:0,type:1,speed:1}}randomRange(e,t){return Math.floor(Math.random()*(t-e-1))+e}init(){for(let e=0;e<this.stars.length;e++)this.stars[e]=this.createStar(),this.updateStar(e,!0)}updateStar(e,t=!1){this.stars[e].x=this.randomRange(-25,25),this.stars[e].y=this.randomRange(-25,25),this.stars[e].z=t?this.randomRange(1,this.maxDepth):this.maxDepth,this.stars[e].type=Math.floor(Math.random()*5),this.stars[e].speed=Math.floor(Math.random()*5)+1}rotate2DPoint(e,t,s){const i=s*Math.PI/180,o=Math.cos(i),n=Math.sin(i),r=Math.floor(e*o-t*n),l=Math.floor(e*n+t*o);return[r,l]}updateInfinityCenter(){this.speedCycleTime+=this.speedCycleRate;const e=.5+.5*Math.sin(this.speedCycleTime);this.infinityPathSpeed=this.baseInfinityPathSpeed*(1-this.speedVariationFactor+2*this.speedVariationFactor*e),this.infinityPathTime+=this.infinityPathSpeed,this.secondaryPathTime+=this.secondaryPathSpeed*e;const t=this.infinityPathWidth,s=this.infinityPathHeight,i=this.infinityPathTime,o=t*Math.sin(i),n=s*Math.sin(i)*Math.cos(i),r=this.secondaryPathTime,l=this.secondaryPathScale*Math.sin(2*r),d=this.secondaryPathScale*Math.cos(3*r),u=o+l,m=n+d;this.originX=Math.floor(this.width/2)+u,this.originY=Math.floor(this.height/2)+m}draw(){this.rotationCycleTime+=this.rotationCycleRate;const e=Math.sin(this.rotationCycleTime);this.angle+=this.rotationSpeed*e,this.updateInfinityCenter();for(let t=0;t<this.stars.length;t++){const s=this.stars[t],i=this.starColors[s.type]||"#fff";if(s.z-=s.speed,s.z<=0){this.updateStar(t);continue}const o=this.rotate2DPoint(s.x,s.y,this.angle),n=this.depthFactor/s.z,r=Math.floor(o[0]*n+this.originX),l=Math.floor(o[1]*n+this.originY);r>=0&&r<=this.width&&l>=0&&l<=this.height&&(this.ctx.fillStyle=i,this.ctx.fillRect(r,l,this.starWidth,this.starWidth))}}}class Z{constructor(e,t,s,i,o=0){this.ctx=e,this.sprite=t,this.tilesWidth=s,this.outputWidth=i,this.extraAddon=o,this.coord={x:0,y:0},this.pixelPos={x:0,y:0},this.moved=!1,this.movement=M.DIRECTION.DOWN,this.drawShadow=!0,this.movementDuration=h.getMovementDuration(),this.animations={},this.currentAnimation="idle",this.animStartTime=0,this.animationFrameId=null,this.targetGridPos={x:0,y:0},this.lastWalkingFrame=0,this.idle=Date.now(),this.idleFx=!1,this.idleThreshold=M.IDLE_TIMEOUT,this.lastWhistleTime=0,this.isMoving=!1,this.moveInterval=null,this.moveSpeed=20,this.initAnimations(),this.findStartPosition()}initAnimations(){this.animations={idle:{frames:[0],speed:500,currentFrame:0,lastFrameTime:0},walking:{frames:Array.from({length:M.ANIMATION.FRAME_COUNT},(e,t)=>t),speed:M.ANIMATION.WALKING_SPEED,currentFrame:0,lastFrameTime:0},special:{frames:[0,1,2,3,2,1,0],speed:200,currentFrame:0,lastFrameTime:0}}}findStartPosition(){const e=h.levelData,{width:t,layers:s}=e;for(let i=0;i<t;i++)for(let o=0;o<t;o++){const n=i*t+o;if(s[0].data[n]===88){this.coord.x=o,this.coord.y=i,this.pixelPos.x=o,this.pixelPos.y=i,this.moved=!1;return}}console.error("No player start position found in level data!")}checkTile(e,t,s,i){const o=h.levelData;if(e<0||t<0||e>=o.width||t>=o.height)return!1;const n=t*o.width+e;return o.layers[s].data[n]===i}checkCoord(e,t){return h.level.isWakable(e,t,0)}checkBox(e,t){return h.boxes.isBlock(e,t)}setupMovement(e,t){e===1?this.movement=M.DIRECTION.RIGHT:e===-1?this.movement=M.DIRECTION.LEFT:t===1?this.movement=M.DIRECTION.DOWN:t===-1&&(this.movement=M.DIRECTION.UP),this.setAnimation("walking")}setAnimation(e){if(!this.animations[e]){console.warn(`Animation type '${e}' doesn't exist`);return}this.currentAnimation!==e&&(this.currentAnimation=e,e==="walking"?this.animations[e].currentFrame=this.lastWalkingFrame:this.animations[e].currentFrame=0,this.animations[e].lastFrameTime=performance.now(),this.animationFrameId&&cancelAnimationFrame(this.animationFrameId))}updateAnimation(e){const t=this.animations[this.currentAnimation];e-t.lastFrameTime>=t.speed&&(t.currentFrame=(t.currentFrame+1)%t.frames.length,t.lastFrameTime=e)}movePlayer(e,t,s){if(e.isMoving)return!1;this.idle=Date.now(),this.idleFx=!1,h.resources.playSound("running",.8,.2),this.targetGridPos={x:e.coord.x+t,y:e.coord.y+s},this.isMoving||(this.pixelPos.x=e.coord.x,this.pixelPos.y=e.coord.y),e.isMoving=!0,this.isMoving=!0,this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.setAnimation("walking"),this.animStartTime=performance.now();const i=o=>{this.animStartTime||(this.animStartTime=o);const n=o-this.animStartTime,r=this.movementDuration;let l=Math.min(n/r,1);l=this._easeInOutQuad(l),this.pixelPos.x=e.coord.x+t*l,this.pixelPos.y=e.coord.y+s*l;const d=this.animations[this.currentAnimation],u=d.frames.length,m=Math.floor(l*u)%u;d.currentFrame=m,this.lastWalkingFrame=m,l<1?this.animationFrameId=requestAnimationFrame(i):(e.isMoving=!1,this.isMoving=!1,e.coord.x=this.targetGridPos.x,e.coord.y=this.targetGridPos.y,this.pixelPos.x=e.coord.x,this.pixelPos.y=e.coord.y,h.score.moves++,this.animationFrameId=null,this.animStartTime=0,this.setAnimation("idle"),h.checkLevelComplete())};return this.animationFrameId=requestAnimationFrame(i),!0}_easeInOutQuad(e){return e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2}move(e,t){if(this.isMoving||h.state!==c.PLAY)return!1;this.setupMovement(e,t);const s=this.coord.x+e,i=this.coord.y+t;if(!this.checkCoord(s,i))return this.setAnimation("idle"),!1;if(this.checkBox(s,i)){const o=s+e,n=i+t,r=this.checkCoord(o,n),l=!this.checkBox(o,n);if(r&&l){const d=h.levelData,u=i*d.width+s,m=n*d.width+o;if(d.layers[2].data[u]=0,d.layers[2].data[m]=94,!h.boxes.move(s,i,o,n))return this.setAnimation("idle"),!1}else return this.setAnimation("idle"),!1}return this.moved===!1&&(this.moved=!0,h.score.startTimer()),this.movePlayer(this,e,t)}idleDetector(){const e=Date.now();!this.idleFx&&h.state===c.PLAY&&e-this.idle>this.idleThreshold&&!this.isMoving&&e-this.lastWhistleTime>this.idleThreshold&&(this.movement=M.DIRECTION.DOWN,h.resources.playSound("whistle",.8,.1),this.lastWhistleTime=e,this.setAnimation("special"),this.idleFx=!0,setTimeout(()=>{this.idleFx=!1,this.setAnimation("idle")},this.animations.special.speed*this.animations.special.frames.length+500))}draw(){this.isMoving||this.updateAnimation(performance.now());const e=this.animations[this.currentAnimation].frames[this.animations[this.currentAnimation].currentFrame],t=h.level.outputWidth,s=this.extraAddon*h.level.scaleFactor;let i=0;if(this.currentAnimation==="jump"){const o=this.animations[this.currentAnimation].currentFrame,n=this.animations[this.currentAnimation].frames.length;i=-(Math.sin(Math.PI*o/(n-1))*10)*h.level.scaleFactor}this.drawShadow&&(this.ctx.save(),this.ctx.fillStyle="rgba(0, 0, 0, 0.3)",this.ctx.beginPath(),this.ctx.ellipse(h.level.startX+this.pixelPos.x*t+t/2,h.level.startY+this.pixelPos.y*t+t*.9,t*.3,t*.1,0,0,Math.PI*2),this.ctx.fill(),this.ctx.restore()),this.ctx.drawImage(this.sprite,e*this.tilesWidth,this.movement*this.tilesWidth,this.tilesWidth,this.tilesWidth,h.level.startX+this.pixelPos.x*t-s/2,h.level.startY+this.pixelPos.y*t-s+i,t+s,t+s)}}class J{constructor(e,t,s,i){this.ctx=e,this.tiles=t,this.tileWidth=s,this.tilesPerRow=Math.floor(this.tiles.naturalWidth/s),this.walkableTiles=I.WALKABLE_TILES,this.outputWidth=i,this.baseOutputWidth=i,this.tileCache=new Map,this.startX=0,this.startY=0,this.scaleFactor=1,this.topReservedSpace=100,this.bottomReservedSpace=130,this.initLevel()}initLevel(){if(!h||!h.levelData){console.warn("Level data not available yet - will initialize later");return}const e=h.levelData,t=this.ctx.canvas.width,s=this.ctx.canvas.height-this.topReservedSpace-this.bottomReservedSpace,i=t/e.width,o=s/e.height,n=Math.floor(Math.min(i,o));if(this.scaleFactor=n/this.baseOutputWidth,this.scaleFactor=Math.max(.5,Math.min(this.scaleFactor,1.5)),this.outputWidth=Math.floor(this.baseOutputWidth*this.scaleFactor),this.startX=Math.max(0,Math.floor((t-e.width*this.outputWidth)/2)),this.startY=Math.max(0,Math.floor(this.topReservedSpace+(s-e.height*this.outputWidth)/2)),this.tileCache.clear(),!e.layers||!Array.isArray(e.layers)){console.error("Error: levelData array is not properly initialized.");return}if(!e.layers.every(r=>r&&r.data&&Array.isArray(r.data))){console.error("Error: levelData data structure is invalid.");return}}getCachedTile(e){if(e<=0)return null;const t=`${e}_${this.scaleFactor.toFixed(2)}`;if(this.tileCache.has(t))return this.tileCache.get(t);const s=document.createElement("canvas");s.width=this.outputWidth,s.height=this.outputWidth;const i=s.getContext("2d"),o=this.calculateTilePosition(e,this.tileWidth);return i.drawImage(this.tiles,o.x,o.y,this.tileWidth,this.tileWidth,0,0,this.outputWidth,this.outputWidth),this.tileCache.set(t,s),s}isWakable(e,t,s){const i=h.levelData;if(!i||e<0||t<0||e>=i.width||t>=i.height)return!1;const o=t*i.width+e;return this.walkableTiles.includes(i.layers[s].data[o])}calculateTilePosition(e,t){e--,e<0&&(e=0);const s=Math.floor(e%this.tilesPerRow*t),i=Math.floor(Math.floor(e/this.tilesPerRow)*t);return{x:s,y:i}}getTileIdFromCoords(e,t){const s=h.levelData;return s?t*s.width+e:0}draw(){const{ctx:e}=this,t=h.levelData;if(!t||!t.layers)return;this.startX===0&&this.startY===0&&this.initLevel();const s=t.layers[0];for(let i=0;i<t.height;i++)for(let o=0;o<t.width;o++){const n=this.getTileIdFromCoords(o,i),r=s.data[n];if(r>0){const l=this.getCachedTile(r);if(l){const d=this.startX+o*this.outputWidth,u=this.startY+i*this.outputWidth;e.drawImage(l,d,u),E.ENABLED&&E.SHOW_TILE_NUMBERS&&(e.save(),e.fillStyle="rgba(0, 0, 0, 0.5)",e.fillRect(d+2,u+2,this.outputWidth-4,16),e.font="10px Arial",e.fillStyle="white",e.textAlign="center",e.fillText(r.toString(),d+this.outputWidth/2,u+14),e.restore()),E.ENABLED&&E.SHOW_COORDINATES&&(e.save(),e.font="10px Arial",e.fillStyle="yellow",e.textAlign="center",e.fillText(`${o},${i}`,d+this.outputWidth/2,u+this.outputWidth-5),e.restore())}}}E.ENABLED&&E.SHOW_GRID_LINES&&this.drawGrid(t.width,t.height)}drawGrid(e,t){const{ctx:s}=this;s.save(),s.strokeStyle="rgba(255, 255, 255, 0.3)",s.lineWidth=1;for(let i=0;i<=e;i++){const o=this.startX+i*this.outputWidth;s.beginPath(),s.moveTo(o,this.startY),s.lineTo(o,this.startY+t*this.outputWidth),s.stroke()}for(let i=0;i<=t;i++){const o=this.startY+i*this.outputWidth;s.beginPath(),s.moveTo(this.startX,o),s.lineTo(this.startX+e*this.outputWidth,o),s.stroke()}s.restore()}getCoordData(e,t){const s=h.levelData;if(!s||!s.layers)return[0,0,0];const i=t*s.width+e,o=[];return s.layers.forEach(n=>{n.data&&Array.isArray(n.data)&&i<n.data.length&&o.push(n.data[i])}),o}hasNumberHigherThanOne(e){return e.some(t=>t>1)}isWalkableCord(e,t){const s=h.levelData;if(!s||e<0||t<0||e>=s.width||t>=s.height)return 0;const i=this.getCoordData(e,t);return this.hasNumberHigherThanOne(i)==!0?0:1}}class q{constructor(){this.emitters=[]}createFireworks(e,t,s,i=30,o=["#ffaa00","#ff8800","#ff5500","#ff0000","#ffff00"]){const n={id:Date.now()+Math.random(),ctx:e,particles:[],startTime:Date.now(),duration:1500,isExpired:!1};for(let r=0;r<i;r++){const l=Math.random()*Math.PI*2,d=1+Math.random()*3,u=Math.cos(l)*d,m=Math.sin(l)*d,f=o[Math.floor(Math.random()*o.length)];n.particles.push({x:t,y:s,vx:u,vy:m,radius:1+Math.random()*2,color:f,alpha:1,life:1})}this.emitters.push(n)}update(e){const t=e/1e3;for(let s=this.emitters.length-1;s>=0;s--){const i=this.emitters[s];if(Date.now()-i.startTime>i.duration){i.isExpired=!0,this.emitters.splice(s,1);continue}for(let o=i.particles.length-1;o>=0;o--){const n=i.particles[o];n.x+=n.vx,n.y+=n.vy,n.vy+=2*t;const r=t*1.5;n.life-=r,n.alpha=n.life,n.radius*=.99,(n.life<=0||n.radius<.1)&&i.particles.splice(o,1)}}}draw(){for(const e of this.emitters){const{ctx:t}=e;for(const s of e.particles)t.save(),t.globalAlpha=s.alpha,t.beginPath(),t.arc(s.x,s.y,s.radius,0,Math.PI*2),t.fillStyle=s.color,t.fill(),t.restore()}}hasActiveEmitters(){return this.emitters.length>0}}class K{constructor(e,t,s,i){this.ctx=e,this.tiles=t,this.tileWidth=s,this.outputWidth=i,this.tilesPerRow=Math.floor(this.tiles.naturalWidth/s),this.isMoving=!1,this.moveSpeed=25,this.moveSmoothness=N.ANIMATION_SMOOTHNESS,this.movementDuration=h.getMovementDuration(),this.boxes=this.parseBoxes(),this.moveIntervals={},this.animationFrameIds={},this.NORMAL_BOX_TILE=94,this.GOAL_BOX_TILE=95,this.pulseEffectDuration=2e3,this.particles=new q,this.lastUpdateTime=performance.now()}parseBoxes(){const e=[],t=h.levelData;if(!t||!t.layers||t.layers.length<3)return console.warn("Invalid level data for boxes"),e;for(let s=0;s<t.height;s++)for(let i=0;i<t.width;i++){const o=s*t.width+i;t.layers[2].data[o]>0&&e.push({id:`box_${e.length}`,x:i,y:s,pixelPos:{x:i,y:s},tile:t.layers[2].data[o],parked:!1,isMoving:!1,animStartTime:0,goalEffectTimestamp:0})}return e}calculateTilePosition(e,t){e--,e<0&&(e=0);const s=Math.floor(e%this.tilesPerRow*t),i=Math.floor(Math.floor(e/this.tilesPerRow)*t);return{x:s,y:i}}isBlock(e,t){return this.boxes.some(s=>Math.round(s.x)===e&&Math.round(s.y)===t&&!s.isMoving)}getBoxAt(e,t){return this.boxes.find(s=>Math.round(s.x)===e&&Math.round(s.y)===t&&!s.isMoving)||null}move(e,t,s,i){const o=this.boxes.findIndex(n=>Math.round(n.x)===e&&Math.round(n.y)===t&&!n.isMoving);return o!==-1?this.moveObject(o,e,t,s,i):!1}isGoalPosition(e,t){return h.goal.goals.some(s=>s.x===e&&s.y===t)}moveObject(e,t,s,i,o){const n=this.boxes[e];if(n.isMoving||this.isMoving)return!1;h.resources.playSound("pushing",.7,.3),n.pixelPos.x=t,n.pixelPos.y=s,this.isMoving=!0,n.isMoving=!0,this.animationFrameIds[n.id]&&(cancelAnimationFrame(this.animationFrameIds[n.id]),this.animationFrameIds[n.id]=null),n.animStartTime=performance.now();const r=l=>{n.animStartTime||(n.animStartTime=l);const d=l-n.animStartTime,u=this.movementDuration;let m=Math.min(d/u,1);m=this._easeInOutQuad(m),n.pixelPos.x=t+(i-t)*m,n.pixelPos.y=s+(o-s)*m,m<1?this.animationFrameIds[n.id]=requestAnimationFrame(r):(this.isMoving=!1,n.isMoving=!1,n.x=i,n.y=o,n.pixelPos.x=i,n.pixelPos.y=o,h.score.pushes++,this.animationFrameIds[n.id]=null,n.animStartTime=0,this.updateBoxState(n,i,o),h.checkLevelComplete())};return this.animationFrameIds[n.id]=requestAnimationFrame(r),!0}_easeInOutQuad(e){return e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2}updateBoxState(e,t,s){e.parked=!1;for(const i of h.goal.goals)if(i.x===t&&i.y===s){e.tile=this.GOAL_BOX_TILE,e.parked=!0,e.goalEffectTimestamp=Date.now(),h.resources.playSound("boxOnGoal",.8,.2),this.particles.createFireworks(this.ctx,h.level.startX+e.x*this.outputWidth+this.outputWidth/2,h.level.startY+e.y*this.outputWidth-this.outputWidth/2,50,["#ffdd00","#ff8800","#ff5500","#ff0000","#ffff00","#88ff00","#00ffff","#8800ff"]),this.updateBoxesScore();return}e.tile=this.NORMAL_BOX_TILE,this.updateBoxesScore()}updateBoxesScore(){const e=this.boxes.filter(s=>s.parked).length,t=this.boxes.length;return h.score&&h.score.updateBoxesCount(e,t),{boxesOnGoal:e,totalBoxes:t}}resetBoxes(){Object.values(this.moveIntervals).forEach(e=>{clearInterval(e)}),Object.values(this.animationFrameIds).forEach(e=>{e&&cancelAnimationFrame(e)}),this.isMoving=!1,this.moveIntervals={},this.animationFrameIds={},this.boxes=this.parseBoxes(),this.updateBoxesScore()}draw(){if(!h.level)return;const{ctx:e}=this;for(const i of this.boxes){const o=this.calculateTilePosition(i.tile,this.tileWidth),n=h.level.outputWidth;e.drawImage(this.tiles,o.x,o.y,this.tileWidth,this.tileWidth,h.level.startX+i.pixelPos.x*n,h.level.startY+i.pixelPos.y*n,n,n);const r=Date.now();i.parked&&i.goalEffectTimestamp>0&&r-i.goalEffectTimestamp<this.pulseEffectDuration&&this.drawPulseEffect(i)}const t=performance.now(),s=t-this.lastUpdateTime;this.lastUpdateTime=t,this.particles.update(s),this.particles.draw(this.ctx)}drawPulseEffect(e){const t=h.level.outputWidth,i=(Date.now()-e.goalEffectTimestamp)/this.pulseEffectDuration,o=Math.max(0,1-i*1.5),n=Math.sin(Date.now()/200)*.1+.9,r=t*n,l=(t-r)/2;this.ctx.save(),this.ctx.globalAlpha=.3*o,this.ctx.strokeStyle="#ffaa00",this.ctx.lineWidth=2,this.ctx.strokeRect(h.level.startX+e.pixelPos.x*t+l,h.level.startY+e.pixelPos.y*t+l,r,r),this.ctx.restore()}}class ${constructor(e,t,s,i){this.ctx=e,this.tiles=t,this.tileWidth=s,this.tilesPerRow=Math.floor(this.tiles.naturalWidth/s),this.outputWidth=i,this.goals=this.parseGoals()}parseGoals(){const t=[],s=h.levelData;if(!s||!s.layers||s.layers.length<2)return console.warn("Invalid level data for goals"),t;for(let i=0;i<s.height;i++)for(let o=0;o<s.width;o++){const n=i*s.width+o,r=s.layers[1].data[n];r>0&&t.push({x:o,y:i,tile:r})}return t}calculateTilePosition(e,t){e--,e<0&&(e=0);const s=Math.floor(e%this.tilesPerRow*t),i=Math.floor(Math.floor(e/this.tilesPerRow)*t);return{x:s,y:i}}getTileIdFromCoords(e,t){const s=h.levelData;return s?t*s.width+e:0}resetGoals(){this.goals=this.parseGoals()}draw(){if(!h.level)return;const{ctx:e}=this;for(const t of this.goals){const s=this.calculateTilePosition(t.tile,this.tileWidth),i=h.level.outputWidth;e.drawImage(this.tiles,s.x,s.y,this.tileWidth,this.tileWidth,h.level.startX+t.x*i,h.level.startY+t.y*i,i,i)}}}class Q{constructor(e,t){this.ctx=e,this.resources=t,this.level=0,this.moves=0,this.pushes=0,this.boxesOnGoal=0,this.totalBoxes=0,this.startTime=null,this.elapsedTime=0,this.isRunning=!1,this.textElements={level:"Level",moves:"Moves",pushes:"Pushes",time:"Time"}}updateTexts(e){e&&(this.textElements.level=e.get("game.level"),this.textElements.moves=e.get("game.moves"),this.textElements.pushes=e.get("game.pushes"),this.textElements.time=e.get("game.time"))}startTimer(){this.isRunning||(this.startTime=Date.now()-this.elapsedTime,this.isRunning=!0)}stopTimer(){this.isRunning&&(this.elapsedTime=Date.now()-this.startTime,this.isRunning=!1)}resetTimer(){this.startTime=null,this.elapsedTime=0,this.isRunning=!1}resetStats(){this.moves=0,this.pushes=0,this.boxesOnGoal=0,this.totalBoxes=0,this.resetTimer()}formatTime(e){const t=Math.floor(e/1e3),s=Math.floor(t/60),i=t%60;return`${s.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`}incrementPushes(){this.pushes++}updateTimer(){this.isRunning&&this.startTime&&(this.elapsedTime=Date.now()-this.startTime)}updateBoxesCount(e,t){this.boxesOnGoal=e,this.totalBoxes=t}draw(){this.updateTimer();const{ctx:e}=this,t=e.canvas.width,s=e.canvas.height,i=130,o=s-i;this.resources.images&&this.resources.images.woodPanel&&this.resources.images.woodPanel.image?e.drawImage(this.resources.images.woodPanel.image,0,o,t,i):(e.fillStyle="rgba(0, 0, 0, 0.7)",e.fillRect(0,o,t,i));const r=t-120,l=Math.floor(r/5),d=Math.floor(l*.5),u=Math.floor(l*1.5),m=Math.floor(l*2.5),f=Math.floor(l*3.5),g=Math.floor(l*4.5),p=32,x=o+i*.35+22,y=o+i*.75+7;e.font="22px Arial",e.textAlign="center";const P=`${this.level}`,D=`${this.moves}`,w=`${this.pushes}`,k=this.formatTime(this.elapsedTime),W=`${this.boxesOnGoal}/${this.totalBoxes}`;if(this.resources.images){if(this.resources.images.scoreLevel&&this.resources.images.scoreLevel.image){const L=d-p/2,C=x-p/2;e.drawImage(this.resources.images.scoreLevel.image,L,C,p,p),e.fillStyle="rgba(0,0,0,0.5)",e.fillText(P,d,y+1),e.fillStyle="#ffaa00",e.fillText(P,d,y)}if(this.resources.images.scoreMoves&&this.resources.images.scoreMoves.image){const L=u-p/2,C=x-p/2;e.drawImage(this.resources.images.scoreMoves.image,L,C,p,p),e.fillStyle="rgba(0,0,0,0.5)",e.fillText(D,u,y+1),e.fillStyle="#ffaa00",e.fillText(D,u,y)}if(this.resources.images.scorePushes&&this.resources.images.scorePushes.image){const L=m-p/2,C=x-p/2;e.drawImage(this.resources.images.scorePushes.image,L,C,p,p),e.fillStyle="rgba(0,0,0,0.5)",e.fillText(w,m,y+1),e.fillStyle="#ffaa00",e.fillText(w,m,y)}if(this.resources.images.scoreBoxes&&this.resources.images.scoreBoxes.image){const L=f-p/2,C=x-p/2;e.drawImage(this.resources.images.scoreBoxes.image,L,C,p,p),e.fillStyle="rgba(0,0,0,0.5)",e.fillText(W,f,y+1),e.fillStyle="#ffaa00",e.fillText(W,f,y)}if(this.resources.images.scoreTime&&this.resources.images.scoreTime.image){const L=g-p/2,C=x-p/2;e.drawImage(this.resources.images.scoreTime.image,L,C,p,p),e.fillStyle="rgba(0,0,0,0.5)",e.fillText(k,g,y+1),e.fillStyle="#ffaa00",e.fillText(k,g,y)}}}}const ee={title:"Sokoban",menu:{newGame:"New Game",continue:"Continue",selectLevel:"Select Level",settings:"Settings",help:"Help",about:"About"},game:{level:"Level",moves:"Moves",pushes:"Pushes",time:"Time",restart:"Restart Level",undo:"Undo Move",completed:"Level Completed!",nextLevel:"Press Space to Continue",victory:"Congratulations!",allLevelsComplete:"Congratulations! You've completed all levels!",confirmExit:"Return to main menu?",confirmRestart:"Are you sure you want to restart the level?",loading:"Loading..."},settings:{language:"Language",sound:"Sound",music:"Music",controls:"Controls",back:"Back",on:"On",off:"Off",paused:"PAUSED",resumeHint:"Press ESC or P to resume",movementSpeed:"Movement Speed"},speeds:{slow:"Slow",normal:"Normal",fast:"Fast",veryFast:"Very Fast"},loading:{title:"Loading",preparing:"Press Space to Load Game",loading:"Loading"},error:{loading:"Error loading game resources. Please refresh."},buttons:{play:"Play",home:"Home",levelSelect:"Level Select",restart:"Restart",toggleMusic:"Toggle Music",pause:"Pause Game",close:"Close"}},te={title:"Sokoban",menu:{newGame:"Neues Spiel",continue:"Fortsetzen",selectLevel:"Level auswählen",settings:"Einstellungen",help:"Hilfe",about:"Über"},game:{level:"Level",moves:"Züge",pushes:"Schübe",time:"Zeit",restart:"Level neu starten",undo:"Zug rückgängig",completed:"Level geschafft!",nextLevel:"Drücke Leertaste zum Fortfahren",victory:"Glückwunsch!",allLevelsComplete:"Glückwunsch! Du hast alle Level abgeschlossen!",confirmExit:"Zurück zum Hauptmenü?",confirmRestart:"Bist du sicher, dass du das Level neu starten möchtest?",loading:"Wird geladen..."},settings:{language:"Sprache",sound:"Sound",music:"Musik",controls:"Steuerung",back:"Zurück",on:"An",off:"Aus",paused:"PAUSIERT",resumeHint:"Drücke ESC oder P zum Fortsetzen",movementSpeed:"Bewegungsgeschwindigkeit"},speeds:{slow:"Langsam",normal:"Normal",fast:"Schnell",veryFast:"Sehr schnell"},loading:{title:"Wird geladen",preparing:"Drücke Leertaste zum Laden",loading:"Lädt"},error:{loading:"Fehler beim Laden der Spielressourcen. Bitte Seite neu laden."},buttons:{play:"Spielen",home:"Hauptmenü",levelSelect:"Level auswählen",restart:"Neu starten",toggleMusic:"Musik ein/aus",pause:"Spiel pausieren",close:"Schließen"}},se={title:"Sokoban",menu:{newGame:"Nouveau jeu",continue:"Continuer",selectLevel:"Sélectionner niveau",settings:"Paramètres",help:"Aide",about:"À propos"},game:{level:"Niveau",moves:"Déplacements",pushes:"Poussées",time:"Temps",restart:"Redémarrer niveau",undo:"Annuler mouvement",completed:"Niveau terminé !",nextLevel:"Appuyez sur Espace pour continuer",victory:"Félicitations !",allLevelsComplete:"Félicitations ! Vous avez terminé tous les niveaux !",confirmExit:"Retour au menu principal ?",confirmRestart:"Êtes-vous sûr de vouloir redémarrer le niveau ?",loading:"Chargement..."},settings:{language:"Langue",sound:"Son",music:"Musique",controls:"Contrôles",back:"Retour",on:"Activé",off:"Désactivé",paused:"PAUSE",resumeHint:"Appuyez sur ÉCHAP ou P pour reprendre",movementSpeed:"Vitesse de déplacement"},speeds:{slow:"Lente",normal:"Normale",fast:"Rapide",veryFast:"Très rapide"},loading:{title:"Chargement",preparing:"Appuyez sur Espace pour charger le jeu",loading:"Chargement"},error:{loading:"Erreur de chargement des ressources. Veuillez rafraîchir la page."},buttons:{play:"Jouer",home:"Accueil",levelSelect:"Sélectionner niveau",restart:"Redémarrer",toggleMusic:"Activer/Désactiver musique",pause:"Mettre en pause",close:"Fermer"}},ie={title:"Sokoban",menu:{newGame:"Nuevo juego",continue:"Continuar",selectLevel:"Seleccionar nivel",settings:"Ajustes",help:"Ayuda",about:"Acerca de"},game:{level:"Nivel",moves:"Movimientos",pushes:"Empujones",time:"Tiempo",restart:"Reiniciar nivel",undo:"Deshacer movimiento",completed:"¡Nivel completado!",nextLevel:"Presiona Espacio para continuar",victory:"¡Felicitaciones!",allLevelsComplete:"¡Felicitaciones! ¡Has completado todos los niveles!",confirmExit:"¿Volver al menú principal?",confirmRestart:"¿Estás seguro de que quieres reiniciar el nivel?",loading:"Cargando..."},settings:{language:"Idioma",sound:"Sonido",music:"Música",controls:"Controles",back:"Volver",on:"Activado",off:"Desactivado",paused:"PAUSADO",resumeHint:"Presiona ESC o P para reanudar",movementSpeed:"Velocidad de movimiento"},speeds:{slow:"Lento",normal:"Normal",fast:"Rápido",veryFast:"Muy rápido"},loading:{title:"Cargando",preparing:"Presiona Espacio para cargar el juego",loading:"Cargando"},error:{loading:"Error al cargar recursos del juego. Por favor, actualiza la página."},buttons:{play:"Jugar",home:"Inicio",levelSelect:"Seleccionar nivel",restart:"Reiniciar",toggleMusic:"Activar/Desactivar música",pause:"Pausar juego",close:"Cerrar"}},oe={title:"Sokoban",menu:{newGame:"Nova igra",continue:"Nadaljuj",selectLevel:"Izberi stopnjo",settings:"Nastavitve",help:"Pomoč",about:"O igri"},game:{level:"Stopnja",moves:"Premiki",pushes:"Potisni",time:"Čas",restart:"Ponovno začni stopnjo",undo:"Razveljavi premik",completed:"Stopnja končana!",nextLevel:"Pritisni preslednico za nadaljevanje",victory:"Čestitke!",allLevelsComplete:"Čestitke! Zaključili ste vse stopnje!",confirmExit:"Nazaj na glavni meni?",confirmRestart:"Ali ste prepričani, da želite ponovno začeti stopnjo?",loading:"Nalaganje..."},settings:{language:"Jezik",sound:"Zvok",music:"Glasba",controls:"Kontrole",back:"Nazaj",on:"Vključeno",off:"Izključeno",paused:"PREMOR",resumeHint:"Pritisni ESC ali P za nadaljevanje",movementSpeed:"Hitrost premikanja"},speeds:{slow:"Počasno",normal:"Normalno",fast:"Hitro",veryFast:"Zelo hitro"},loading:{title:"Nalaganje",preparing:"Pritisni preslednico za začetek igre",loading:"Nalaganje"},error:{loading:"Napaka pri nalaganju virov igre. Prosimo, osvežite stran."},buttons:{play:"Igraj",home:"Domov",levelSelect:"Izberi stopnjo",restart:"Ponovno zaženi",toggleMusic:"Vklopi/izklopi glasbo",pause:"Premor igre",close:"Zapri"}},ae={title:"Sokoban",menu:{newGame:"Nova igra",continue:"Nastavi",selectLevel:"Odaberi razinu",settings:"Postavke",help:"Pomoć",about:"O nama"},game:{level:"Razina",moves:"Potezi",pushes:"Guranja",time:"Vrijeme",restart:"Ponovi razinu",undo:"Poništi potez",completed:"Razina završena!",nextLevel:"Pritisni razmak za nastavak",victory:"Čestitamo!",allLevelsComplete:"Čestitamo! Završili ste sve razine!",confirmExit:"Povratak na glavni izbornik?",confirmRestart:"Jeste li sigurni da želite ponovno pokrenuti razinu?",loading:"Učitavanje..."},settings:{language:"Jezik",sound:"Zvuk",music:"Glazba",controls:"Kontrole",back:"Natrag",on:"Uključeno",off:"Isključeno",paused:"PAUZIRANO",resumeHint:"Pritisnite ESC ili P za nastavak",movementSpeed:"Brzina kretanja"},speeds:{slow:"Sporo",normal:"Normalno",fast:"Brzo",veryFast:"Vrlo brzo"},loading:{title:"Učitavanje",preparing:"Pritisni razmak za učitavanje igre",loading:"Učitavanje"},error:{loading:"Greška prilikom učitavanja resursa igre. Molimo osvježite stranicu."},buttons:{play:"Igraj",home:"Početna",levelSelect:"Odaberi razinu",restart:"Ponovi",toggleMusic:"Uključi/isključi glazbu",pause:"Pauziraj igru",close:"Zatvori"}},ne={title:"Sokoban",menu:{newGame:"Új játék",continue:"Folytatás",selectLevel:"Pálya választása",settings:"Beállítások",help:"Segítség",about:"Névjegy"},game:{level:"Pálya",moves:"Lépések",pushes:"Tolások",time:"Idő",restart:"Újrakezdés",undo:"Visszavonás",completed:"Pálya teljesítve!",nextLevel:"Nyomj szóközt a folytatáshoz",victory:"Gratulálunk!",allLevelsComplete:"Gratulálunk! Minden pályát teljesítettél!",confirmExit:"Vissza a főmenübe?",confirmRestart:"Biztosan újra szeretnéd kezdeni a pályát?",loading:"Betöltés..."},settings:{language:"Nyelv",sound:"Hang",music:"Zene",controls:"Irányítás",back:"Vissza",on:"Be",off:"Ki",paused:"SZÜNET",resumeHint:"Nyomj ESC-et vagy P-t a folytatáshoz",movementSpeed:"Mozgási sebesség"},speeds:{slow:"Lassú",normal:"Normál",fast:"Gyors",veryFast:"Nagyon gyors"},loading:{title:"Betöltés",preparing:"Nyomj szóközt a játék betöltéséhez",loading:"Betöltés"},error:{loading:"Hiba a játék erőforrásainak betöltésekor. Kérjük, frissítsd az oldalt."},buttons:{play:"Játék",home:"Főoldal",levelSelect:"Pálya választása",restart:"Újrakezdés",toggleMusic:"Zene be/ki",pause:"Játék szüneteltetése",close:"Bezárás"}},re={title:"Sokoban",menu:{newGame:"Nová hra",continue:"Pokračovat",selectLevel:"Výběr úrovně",settings:"Nastavení",help:"Nápověda",about:"O hře"},game:{level:"Úroveň",moves:"Tahů",pushes:"Tlačení",time:"Čas",restart:"Restartovat úroveň",undo:"Vrátit tah",completed:"Úroveň dokončena!",nextLevel:"Stiskněte mezerník pro pokračování",victory:"Gratulujeme!",allLevelsComplete:"Gratulujeme! Dokončili jste všechny úrovně!",confirmExit:"Návrat do hlavního menu?",confirmRestart:"Opravdu chcete restartovat tuto úroveň?",loading:"Načítání..."},settings:{language:"Jazyk",sound:"Zvuk",music:"Hudba",controls:"Ovládání",back:"Zpět",on:"Zapnuto",off:"Vypnuto",paused:"PAUZA",resumeHint:"Stiskněte ESC nebo P pro pokračování",movementSpeed:"Rychlost pohybu"},speeds:{slow:"Pomalá",normal:"Normální",fast:"Rychlá",veryFast:"Velmi rychlá"},loading:{title:"Načítání",preparing:"Stiskněte mezerník pro načtení hry",loading:"Načítání"},error:{loading:"Chyba při načítání herních zdrojů. Prosím obnovte stránku."},buttons:{play:"Hrát",home:"Domů",levelSelect:"Výběr úrovně",restart:"Restartovat",toggleMusic:"Zapnout/vypnout hudbu",pause:"Pozastavit hru",close:"Zavřít"}},le={title:"Sokoban",menu:{newGame:"Nová hra",continue:"Pokračovať",selectLevel:"Výber úrovne",settings:"Nastavenia",help:"Pomoc",about:"O hre"},game:{level:"Úroveň",moves:"Ťahov",pushes:"Tlačení",time:"Čas",restart:"Reštartovať úroveň",undo:"Vrátiť ťah",completed:"Úroveň dokončená!",nextLevel:"Stlačte medzerník pre pokračovanie",victory:"Blahoželáme!",allLevelsComplete:"Blahoželáme! Dokončili ste všetky úrovne!",confirmExit:"Návrat do hlavného menu?",confirmRestart:"Naozaj chcete reštartovať túto úroveň?",loading:"Načítavanie..."},settings:{language:"Jazyk",sound:"Zvuk",music:"Hudba",controls:"Ovládanie",back:"Späť",on:"Zapnuté",off:"Vypnuté",paused:"PAUZA",resumeHint:"Stlačte ESC alebo P pre pokračovanie",movementSpeed:"Rýchlosť pohybu"},speeds:{slow:"Pomalá",normal:"Normálna",fast:"Rýchla",veryFast:"Veľmi rýchla"},loading:{title:"Načítavanie",preparing:"Stlačte medzerník pre načítanie hry",loading:"Načítavanie"},error:{loading:"Chyba pri načítavaní herných zdrojov. Prosím obnovte stránku."},buttons:{play:"Hrať",home:"Domov",levelSelect:"Výber úrovne",restart:"Reštartovať",toggleMusic:"Zapnúť/vypnúť hudbu",pause:"Pozastaviť hru",close:"Zavrieť"}},he={title:"Sokoban",menu:{newGame:"Нова игра",continue:"Настави",selectLevel:"Изабери ниво",settings:"Подешавања",help:"Помоћ",about:"О игри"},game:{level:"Ниво",moves:"Потези",pushes:"Гурања",time:"Време",restart:"Рестартуј ниво",undo:"Поништи потез",completed:"Ниво завршен!",nextLevel:"Притисните Размак за наставак",victory:"Честитамо!",allLevelsComplete:"Честитамо! Завршили сте све нивое!",confirmExit:"Повратак на главни мени?",confirmRestart:"Да ли сте сигурни да желите да рестартујете ниво?",loading:"Учитавање..."},settings:{language:"Језик",sound:"Звук",music:"Музика",controls:"Контроле",back:"Назад",on:"Укључено",off:"Искључено",paused:"ПАУЗА",resumeHint:"Притисните ESC или P за наставак",movementSpeed:"Брзина кретања"},speeds:{slow:"Споро",normal:"Нормално",fast:"Брзо",veryFast:"Веома брзо"},loading:{title:"Учитавање",preparing:"Притисните Размак за учитавање игре",loading:"Учитавање"},error:{loading:"Грешка приликом учитавања ресурса игре. Молимо освежите страницу."},buttons:{play:"Играј",home:"Почетна",levelSelect:"Избор нивоа",restart:"Рестартуј",toggleMusic:"Укључи/искључи музику",pause:"Паузирај игру",close:"Затвори"}},ce={title:"推箱子",menu:{newGame:"新游戏",continue:"继续",selectLevel:"选择关卡",settings:"设置",help:"帮助",about:"关于"},game:{level:"关卡",moves:"步数",pushes:"推动",time:"时间",restart:"重新开始",undo:"撤销",completed:"关卡完成！",nextLevel:"按空格键继续",victory:"恭喜！",allLevelsComplete:"恭喜！你已完成所有关卡！",confirmExit:"返回主菜单？",confirmRestart:"确定要重新开始此关卡吗？",loading:"加载中..."},settings:{language:"语言",sound:"音效",music:"音乐",controls:"控制",back:"返回",on:"开启",off:"关闭",paused:"已暂停",resumeHint:"按ESC或P继续",movementSpeed:"移动速度"},speeds:{slow:"慢速",normal:"正常",fast:"快速",veryFast:"极快"},loading:{title:"加载中",preparing:"按空格键加载游戏",loading:"加载中"},error:{loading:"加载游戏资源时出错。请刷新页面。"},buttons:{play:"开始",home:"主页",levelSelect:"选择关卡",restart:"重新开始",toggleMusic:"切换音乐",pause:"暂停游戏",close:"关闭"}},de={title:"倉庫番",menu:{newGame:"新しいゲーム",continue:"続ける",selectLevel:"レベル選択",settings:"設定",help:"ヘルプ",about:"情報"},game:{level:"レベル",moves:"歩数",pushes:"押し回数",time:"時間",restart:"レベルをやり直す",undo:"元に戻す",completed:"レベルクリア！",nextLevel:"スペースキーで次へ進む",victory:"おめでとう！",allLevelsComplete:"おめでとう！全レベルクリアしました！",confirmExit:"メインメニューに戻りますか？",confirmRestart:"このレベルをやり直しますか？",loading:"ロード中..."},settings:{language:"言語",sound:"効果音",music:"音楽",controls:"操作方法",back:"戻る",on:"オン",off:"オフ",paused:"一時停止中",resumeHint:"ESCキーまたはPキーで再開",movementSpeed:"移動速度"},speeds:{slow:"遅い",normal:"普通",fast:"速い",veryFast:"超速い"},loading:{title:"ロード中",preparing:"スペースキーでゲームを開始",loading:"ロード中"},error:{loading:"ゲームリソースの読み込みエラー。ページを更新してください。"},buttons:{play:"プレイ",home:"ホーム",levelSelect:"レベル選択",restart:"リスタート",toggleMusic:"音楽オン/オフ",pause:"一時停止",close:"閉じる"}},b={en:"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 60 30'><clipPath id='s'><path d='M0,0 v30 h60 v-30 z'/></clipPath><clipPath id='t'><path d='M30,15 h30 v15 z v15 h-30 z h-30 v-15 z v-15 h30 z'/></clipPath><g clip-path='url(%23s)'><path d='M0,0 v30 h60 v-30 z' fill='%23012169'/><path d='M0,0 L60,30 M60,0 L0,30' stroke='%23fff' stroke-width='6'/><path d='M0,0 L60,30 M60,0 L0,30' clip-path='url(%23t)' stroke='%23C8102E' stroke-width='4'/><path d='M30,0 v30 M0,15 h60' stroke='%23fff' stroke-width='10'/><path d='M30,0 v30 M0,15 h60' stroke='%23C8102E' stroke-width='6'/></g></svg>",de:"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1000' height='600' viewBox='0 0 5 3'><rect width='5' height='3' y='0' x='0' fill='%23000'/><rect width='5' height='2' y='1' x='0' fill='%23D00'/><rect width='5' height='1' y='2' x='0' fill='%23FFCE00'/></svg>",fr:"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='900' height='600'><rect width='900' height='600' fill='%23ED2939'/><rect width='600' height='600' fill='%23fff'/><rect width='300' height='600' fill='%23002395'/></svg>",es:"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='750' height='500'><rect width='750' height='500' fill='%23c60b1e'/><rect width='750' height='250' fill='%23ffc400'/></svg>",sl:"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1200' height='600'><rect width='1200' height='600' fill='%23fff'/><rect width='1200' height='400' y='200' fill='%23005CE6'/><rect width='1200' height='200' y='400' fill='%23ED1C24'/></svg>",hr:"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1200' height='600'><rect width='1200' height='200' fill='%23FF0000'/><rect width='1200' height='200' y='200' fill='%23FFFFFF'/><rect width='1200' height='200' y='400' fill='%230093DD'/></svg>",hu:"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1200' height='600'><rect width='1200' height='200' fill='%23ce2939'/><rect width='1200' height='200' y='200' fill='%23fff'/><rect width='1200' height='200' y='400' fill='%23398017'/></svg>",cs:"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 600 400'><path fill='%23d7141a' d='M0 0h600v200H0z'/><path fill='%23fff' d='M0 200h600v200H0z'/><path fill='%2311457e' d='M300 200L0 0v400z'/></svg>",sk:"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 900 600'><path fill='%23ee1c25' d='M0 0h900v200H0z'/><path fill='%230b4ea2' d='M0 200h900v200H0z'/><path fill='%23fff' d='M0 400h900v200H0z'/></svg>",sr:"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='1350' height='900'><rect width='1350' height='300' fill='%23c6363c'/><rect width='1350' height='300' y='300' fill='%230c4076'/><rect width='1350' height='300' y='600' fill='%23fff'/></svg>",zh:"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 900 600'><rect fill='%23de2910' x='0' y='0' width='900' height='600'/><g fill='%23ffde00'><path d='M213,60l-15,47h-49l39,28l-15,47l40-29l40,29l-15-47l39-28h-49'/><path d='M330,130l-15,47h-49l39,28l-15,47l40-29l40,29l-15-47l39-28h-49'/><path d='M390,210l-15,47h-49l39,28l-15,47l40-29l40,29l-15-47l39-28h-49'/><path d='M330,290l-15,47h-49l39,28l-15,47l40-29l40,29l-15-47l39-28h-49'/><path d='M213,369l-15,47h-49l39,28l-15,47l40-29l40,29l-15-47l39-28h-49'/></g></svg>",ja:"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 900 600'><rect fill='%23fff' x='0' y='0' width='900' height='600'/><circle fill='%23bc002d' cx='450' cy='300' r='180'/></svg>"};class ue{constructor(){this.languages={en:{name:"English",data:ee,flag:b.en},de:{name:"Deutsch",data:te,flag:b.de},fr:{name:"Français",data:se,flag:b.fr},es:{name:"Español",data:ie,flag:b.es},sl:{name:"Slovenščina",data:oe,flag:b.sl},hr:{name:"Hrvatski",data:ae,flag:b.hr},hu:{name:"Magyar",data:ne,flag:b.hu},cs:{name:"Čeština",data:re,flag:b.cs},sk:{name:"Slovenčina",data:le,flag:b.sk},sr:{name:"Српски",data:he,flag:b.sr},zh:{name:"中文",data:ce,flag:b.zh},ja:{name:"日本語",data:de,flag:b.ja}},this.currentLang=localStorage.getItem("sokoban_language")||"en",this.onLanguageChange=null}getLanguages(){const e={};for(const t in this.languages)e[t]={name:this.languages[t].name,flag:this.languages[t].flag};return e}setLanguage(e){return this.languages[e]?(this.currentLang=e,localStorage.setItem("sokoban_language",e),document.title=this.get("title"),typeof this.onLanguageChange=="function"&&this.onLanguageChange(e),!0):!1}get(e){var o;const t=(o=this.languages[this.currentLang])==null?void 0:o.data;if(!t)return e;const s=e.split(".");let i=t;for(const n of s)if(i&&i[n]!==void 0)i=i[n];else return e;return i}getCurrentLanguage(){return this.currentLang}}class ge{constructor(){this.toLoad={player:v.IMAGES.PLAYER,tiles:v.IMAGES.TILES,main:v.IMAGES.MAIN_BG,logo:v.IMAGES.LOGO,btnPlay:v.IMAGES.BTN_PLAY,woodPanel:v.IMAGES.WOOD_PANEL,levelBackground:v.IMAGES.LEVEL_BG,scoreLevel:v.IMAGES.SCORE_LEVEL,scoreMoves:v.IMAGES.SCORE_MOVES,scorePushes:v.IMAGES.SCORE_PUSHES,scoreTime:v.IMAGES.SCORE_TIME,scoreBoxes:v.IMAGES.SCORE_BOXES,ACTION_HOME:v.IMAGES.ACTION_HOME,ACTION_LEVEL:v.IMAGES.ACTION_LEVEL,ACTION_MUTE:v.IMAGES.ACTION_MUTE,ACTION_PAUSE:v.IMAGES.ACTION_PAUSE,ACTION_RESTART:v.IMAGES.ACTION_RESTART},this.images={},this.loadPromise=null,this.loadingProgress=0,this.totalAssets=Object.keys(this.toLoad).length,this.i18n=new ue,this.sound={running:new Audio(this._makeRelativePath(v.SOUNDS.RUNNING)),pushing:new Audio(this._makeRelativePath(v.SOUNDS.PUSHING)),boxOnGoal:new Audio(this._makeRelativePath(v.SOUNDS.BOXONGOAL)),victory:new Audio(this._makeRelativePath(v.SOUNDS.VICTORY)),music:new Audio(this._makeRelativePath(v.SOUNDS.MUSIC)),whistle:new Audio(this._makeRelativePath(v.SOUNDS.WHISTLE))},this._configureAudio()}_configureAudio(){this.sound.music.loop=!0,this.sound.music.volume=.4,this.sound.running.volume=.7,this.sound.pushing.volume=.6,this.sound.boxOnGoal.volume=.6,this.sound.victory.volume=.8,this.sound.whistle.volume=.7,Object.values(this.sound).forEach(e=>{e.addEventListener("error",t=>{console.warn(`Audio failed to load: ${e.src}`,t)})})}loadImages(e=null){let t=0;const s=Object.entries(this.toLoad).map(([i,o])=>new Promise(n=>{const r=new Image;r.onload=()=>{this.images[i]={image:r,isLoaded:!0},t++,this.loadingProgress=Math.floor(t/this.totalAssets*100),e&&typeof e=="function"&&e(this.loadingProgress),n()},r.onerror=l=>{console.error(`Failed to load image: ${o}`,l),this.images[i]={image:new Image,isLoaded:!1,error:!0},t++,this.loadingProgress=Math.floor(t/this.totalAssets*100),n()},r.src=o}));return this.loadPromise=Promise.all(s),this.loadPromise}loadAll(e=null){return this.loadImages(e).then(()=>{const t=Object.values(this.sound).map(s=>new Promise(i=>{s.load();const o=()=>{s.removeEventListener("canplaythrough",o),s.removeEventListener("error",n),i()},n=()=>{s.removeEventListener("canplaythrough",o),s.removeEventListener("error",n),console.warn(`Audio preload issue: ${s.src}`),i()};setTimeout(()=>{s.removeEventListener("canplaythrough",o),s.removeEventListener("error",n),i()},3e3),s.addEventListener("canplaythrough",o,{once:!0}),s.addEventListener("error",n,{once:!0})}));return Promise.all(t)})}getImage(e){return this.images[e]&&this.images[e].isLoaded?this.images[e].image:(console.warn(`Image not found or not loaded: ${e}`),null)}playBackgroundMusic(e=!1){try{e&&(this.sound.music.currentTime=0),this.sound.music.paused&&this.sound.music.play().catch(t=>{console.warn("Background music couldn't autoplay:",t)})}catch(t){console.warn("Error playing background music:",t)}}toggleMusic(){const e=this.sound.music;return e.paused?(this.playBackgroundMusic(),!0):(e.pause(),!1)}playSound(e,t=.8,s=.2){try{if(!this.sound[e]){console.warn(`Sound not found: ${e}`);return}const i=this.sound[e];i.volume=Math.min(1,Math.max(0,t+(Math.random()-.5)*s)),i.currentTime=0,i.play().catch(o=>{console.warn(`Couldn't play sound ${e}:`,o)})}catch(i){console.warn(`Error playing sound ${e}:`,i)}}stopAllSounds(e=!0){Object.entries(this.sound).forEach(([t,s])=>{try{if(!e&&t==="music")return;s.pause(),s.currentTime=0}catch(i){console.warn(`Error stopping sound ${t}:`,i)}})}_makeRelativePath(e){return e.startsWith("/")?`.${e}`:e}}let S=null;const O=new Set;let R=null;function me(a){const e=document.getElementById("mainCanvas");e.getContext("2d"),S||(S=document.createElement("div"),S.id="loadingText",S.innerText=a.resources.i18n.get("game.loading"),S.style.position="absolute",S.style.top="55%",S.style.left="50%",S.style.transform="translate(-50%, -50%)",S.style.color="white",S.style.fontFamily="Arial, sans-serif",S.style.fontSize="18px",S.style.textShadow="2px 2px 4px rgba(0,0,0,0.5)",S.style.zIndex="10",document.getElementById("mainContent").appendChild(S)),fe(a),e.addEventListener("click",function(o){H(o,a)});function t(){a.player&&!a.player.isMoving&&a.state===c.PLAY&&(O.has(37)?a.player.move(-1,0):O.has(38)?a.player.move(0,-1):O.has(39)?a.player.move(1,0):O.has(40)&&a.player.move(0,1))}function s(){i(),t(),R=setInterval(t,50)}function i(){R&&(clearInterval(R),R=null)}document.addEventListener("keydown",function(o){if([27,32,37,38,39,40,80,82,68].includes(o.keyCode)&&o.preventDefault(),O.add(o.keyCode),o.keyCode===68&&o.ctrlKey){ye();return}if(o.keyCode===27||o.keyCode===80){a.togglePause();return}if(a.state!==c.PAUSED){if([37,38,39,40].includes(o.keyCode)){s();return}o.keyCode===32?Y(a):o.keyCode===82&&j(a)}}),document.addEventListener("keyup",function(o){O.delete(o.keyCode),[37,38,39,40].some(n=>O.has(n))?[37,38,39,40].includes(o.keyCode)&&s():i()}),window.addEventListener("blur",function(){O.clear(),i()})}function pe(){S&&(S.style.opacity="0",S.style.pointerEvents="none",setTimeout(()=>{S&&S.parentNode&&(S.parentNode.removeChild(S),S=null)},500))}function fe(a){const e=document.getElementById("mainCanvas"),t=document.getElementById("upButton"),s=document.getElementById("leftButton"),i=document.getElementById("rightButton"),o=document.getElementById("downButton"),n=document.getElementById("virtualArrows");a.isMobileDevice()&&n.removeAttribute("hidden"),t.addEventListener("touchstart",w=>{w.preventDefault(),a.player&&!a.player.isMoving&&a.state===c.PLAY&&a.canProcessKeyPress()&&a.player.move(0,-1)}),s.addEventListener("touchstart",w=>{w.preventDefault(),a.player&&!a.player.isMoving&&a.state===c.PLAY&&a.canProcessKeyPress()&&a.player.move(-1,0)}),i.addEventListener("touchstart",w=>{w.preventDefault(),a.player&&!a.player.isMoving&&a.state===c.PLAY&&a.canProcessKeyPress()&&a.player.move(1,0)}),o.addEventListener("touchstart",w=>{w.preventDefault(),a.player&&!a.player.isMoving&&a.state===c.PLAY&&a.canProcessKeyPress()&&a.player.move(0,1)});const r=document.createElement("div");r.id="game-controls",r.style.position="absolute",r.style.top="20px",r.style.left="50%",r.style.transform="translateX(-50%)",r.style.display="flex",r.style.gap="15px",r.style.zIndex="100",r.style.opacity="0",r.style.transition="opacity 0.3s";const l=document.createElement("button");l.id="menu-button",l.title=a.resources.i18n.get("buttons.home");const d=new Image;d.src=a.resources.images.ACTION_HOME.image.src,d.alt="Home",d.style.width="100%",d.style.height="100%",d.style.objectFit="contain",l.appendChild(d),l.style.padding="6px",l.style.backgroundColor="transparent",l.style.border="none",l.style.borderRadius="50%",l.style.cursor="pointer",l.style.width="48px",l.style.height="48px",l.addEventListener("click",()=>{window.confirm(a.resources.i18n.get("game.confirmExit")||"Return to main menu?")&&a.setState(c.INTRO)});const u=document.createElement("button");u.id="level-select-button",u.title=a.resources.i18n.get("buttons.levelSelect");const m=new Image;m.src=a.resources.images.ACTION_LEVEL.image.src,m.alt="Level Select",m.style.width="100%",m.style.height="100%",m.style.objectFit="contain",u.appendChild(m),u.style.padding="6px",u.style.backgroundColor="transparent",u.style.border="none",u.style.borderRadius="50%",u.style.cursor="pointer",u.style.width="48px",u.style.height="48px",u.addEventListener("click",()=>{ve(a)});const f=document.createElement("button");f.id="restart-button",f.title=a.resources.i18n.get("buttons.restart");const g=new Image;g.src=a.resources.images.ACTION_RESTART.image.src,g.alt="Restart",g.style.width="100%",g.style.height="100%",g.style.objectFit="contain",f.appendChild(g),f.style.padding="6px",f.style.backgroundColor="transparent",f.style.border="none",f.style.borderRadius="50%",f.style.cursor="pointer",f.style.width="48px",f.style.height="48px",f.addEventListener("click",()=>{j(a)});const p=document.createElement("button");p.id="music-button",p.title=a.resources.i18n.get("buttons.toggleMusic");const x=new Image;x.src=a.resources.images.ACTION_MUTE.image.src,x.alt="Toggle Music",x.style.width="100%",x.style.height="100%",x.style.objectFit="contain",p.appendChild(x),p.style.padding="6px",p.style.backgroundColor="transparent",p.style.border="none",p.style.borderRadius="50%",p.style.cursor="pointer",p.style.width="48px",p.style.height="48px",a.resources.sound.music.paused&&(p.style.opacity="0.5"),p.addEventListener("click",()=>{const w=a.resources.toggleMusic();p.style.opacity=w?"1":"0.5"});const y=document.createElement("button");y.id="pause-button",y.title=a.resources.i18n.get("buttons.pauseGame");const P=new Image;P.src=a.resources.images.ACTION_PAUSE.image.src,P.alt="Pause",P.style.width="100%",P.style.height="100%",P.style.objectFit="contain",y.appendChild(P),y.style.padding="6px",y.style.backgroundColor="transparent",y.style.border="none",y.style.borderRadius="50%",y.style.cursor="pointer",y.style.width="48px",y.style.height="48px",y.addEventListener("click",()=>{a.togglePause()}),r.appendChild(l),r.appendChild(u),r.appendChild(f),r.appendChild(p),r.appendChild(y),document.getElementById("mainContent").appendChild(r);const D=a.setState;a.setState=function(w){const k=D.call(this,w);return w===c.PLAY?r.style.opacity="1":r.style.opacity="0",k},e.addEventListener("touchstart",w=>{w.preventDefault();const k=a.state;(k===c.LOADING||k===c.INTRO||k===c.WIN)&&H(w,a)})}function H(a,e){const t=document.getElementById("mainCanvas"),s=t.getContext("2d"),i=t.getBoundingClientRect(),o=a.clientX||a.touches&&a.touches[0].clientX,n=a.clientY||a.touches&&a.touches[0].clientY;if(!o||!n)return;const r=o-i.left,l=n-i.top;if(e.state===c.LOADING)e.setState(c.INTRO);else if(e.state===c.INTRO){const d=s.canvas.width/2-e.resources.images.btnPlay.image.width/2,u=e.canvas.height*.8,m=e.resources.images.btnPlay.image.width,f=e.resources.images.btnPlay.image.height;r>=d&&r<=d+m&&l>=u&&l<=u+f&&(e.resources.stopAllSounds(!0),e.setCurrentLevel(0),e.changeLevel(0),e.setState(c.PLAY))}else if(e.state===c.WIN)Y(e);else if(e.state===c.PAUSED){if(e.speedButtons){for(const x of e.speedButtons)if(r>=x.x&&r<=x.x+x.width&&l>=x.y&&l<=x.y+x.height){e.setMovementSpeed(x.value);break}}const d=e.canvas.height/2-100+60,u=d+140,m=440,f=e.canvas.width/2-m/2,g=f+m;(l<d-30||l>u+30||r<f-30||r>g+30)&&e.setState(c.PLAY)}}function Y(a){switch(a.state){case c.LOADING:a.setState(c.INTRO);break;case c.INTRO:a.setState(c.PLAY);break;case c.WIN:a.resources.stopAllSounds(!0);let e=a.currentLevel+1;e>=a.levelsData.length&&(alert(a.resources.i18n.get("game.allLevelsComplete")),e=0),a.setCurrentLevel(e),a.changeLevel(e),a.setState(c.PLAY);break;case c.PAUSED:a.setState(c.PLAY);break}}function j(a){a.state===c.PLAY&&window.confirm(a.resources.i18n.get("game.confirmRestart"))&&a.restartLevel()}function ve(a){const e=document.createElement("div");e.id="level-select-modal",e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.backgroundColor="rgba(0,0,0,0.7)",e.style.zIndex="1000",e.style.display="flex",e.style.justifyContent="center",e.style.alignItems="center";const t=document.createElement("div");t.style.backgroundImage="url(assets/images/background_levels_wood.png)",t.style.backgroundSize="cover",t.style.backgroundPosition="center",t.style.border="8px solid #3a2214",t.style.borderRadius="15px",t.style.padding="20px",t.style.width="80%",t.style.maxWidth="600px",t.style.overflow="hidden",t.style.boxShadow="0 10px 30px rgba(0,0,0,0.8), inset 0 0 20px rgba(0,0,0,0.5)",t.style.position="relative";const s=document.createElement("div");s.style.position="absolute",s.style.top="0",s.style.left="0",s.style.width="100%",s.style.height="100%",s.style.backgroundImage="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAMAAAAp4XiDAAAAUVBMVEWFhYWDg4N3d3dtbW17e3t1dXWBgYGHh4d5eXlzc3OLi4ubm5uVlZWPj4+NjY19fX2JiYl/f39ra2uRkZGZmZlpaWmXl5dvb29xcXGTk5NnZ2c8TV1mAAAAG3RSTlNAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEAvEOwtAAAFVklEQVR4XpWWB67c2BUFb3g557T/hRo9/WUMZHlgr4Bg8Z4qQgQJlHI4A8SzFVrapvmTF9O7dmYRFZ60YiBhJRCgh1FYhiLAmdvX0CzTOpNE77ME0Zty/nWWzchDtiqrmQDeuv3powQ5ta2eN0FY0InkqDD73lT9c9lEzwUNqgFHs9VQce3TVClFCQrSTfOiYkVJQBmpbq2L6iZavPnAPcoU0dSw0SUTqz/GtrGuXfbyyBniKykOWQWGqwwMA7QiYAxi+IlPdqo+hYHnUt5ZPfnsHJyNiDtnpJyayNBkF6cWoYGAMY92U2hXHF/C1M8uP/ZtYdiuj26UdAdQQSXQErwSOMzt/XWRWAz5GuSBIkwG1H3FabJ2OsUOUhGC6tK4EMtJO0ttC6IBD3kM0ve0tJwMdSfjZo+EEISaeTr9P3wYrGjXqyC1krcKdhMpxEnt5JetoulscpyzhXN5FRpuPHvbeQaKxFAEB6EN+cYN6xD7RYGpXpNndMmZgM5Dcs3YSNFDHUo2LGfZuukSWyUYirJAdYbF3MfqEKmjM+I2EfhA94iG3L7uKrR+GdWD73ydlIB+6hgref1QTlmgmbM3/LeX5GI1Ux1RWpgxpLuZ2+I+IjzZ8wqE4nilvQdkUdfhzI5QDWy+kw5Wgg2pGpeEVeCCA7b85BO3F9DzxB3cdqvBzWcmzbyMiqhzuYqtHRVG2y4x+KOlnyqla8AoWWpuBoYRxzXrfKuILl6SfiWCbjxoZJUaCBj1CjH7GIaDbc9kqBY3W/Rgjda1iqQcOJu2WW+76pZC9QG7M00dffe9hNnseupFL53r8F7YHSwJWUKP2q+k7RdsxyOB11n0xtOvnW4irMMFNV4H0uqwS5ExsmP9AxbDTc9JwgneAT5vTiUSm1E7BSflSt3bfa1tv8Di3R8n3Af7MNWzs49hmauE2wP+ttrq+AsWpFG2awvsuOqbipWHgtuvuaAE+A1Z/7gC9hesnr+7wqCwG8c5yAg3AL1fm8T9AZtp/bbJGwl1pNrE7RuOX7PeMRUERVaPpEs+yqeoSmuOlokqw49pgomjLeh7icHNlG19yjs6XXOMedYm5xH2YxpV2tc0Ro2jJfxC50ApuxGob7lMsxfTbeUv07TyYxpeLucEH1gNd4IKH2LAg5TdVhlCafZvpskfncCfx8pOhJzd76bJWeYFnFciwcYfubRc12Ip/ppIhA1/mSZ/RxjFDrJC5xifFjJpY2Xl5zXdguFqYyTR1zSp1Y9p+tktDYYSNflcxI0iyO4TPBdlRcpeqjK/piF5bklq77VSEaA+z8qmJTFzIWiitbnzR794USKBUaT0NTEsVjZqLaFVqJoPN9ODG70IPbfBHKK+/q/AWR0tJzYHRULOa4MP+W/HfGadZUbfw177G7j/OGbIs8TahLyynl4X4RinF793Oz+BU0saXtUHrVBFT/DnA3ctNPoGbs4hRIjTok8i+algT1lTHi4SxFvONKNrgQFAq2/gFnWMXgwffgYMJpiKYkmW3tTg3ZQ9Jq+f8XN+A5eeUKHWvJWJ2sgJ1Sop+wwhqFVijqWaJhwtD8MNlSBeWNNWTa5Z5kPZw5+LbVT99wqTdx29lMUH4OIG/D86ruKEauBjvH5xy6um/Sfj7ei6UUVk4AIl3MyD4MSSTOFgSwsH/QJWaQ5as7ZcmgBZkzjjU1UrQ74ci1gWBCSGHtuV1H2mhSnO3Wp/3fEV5a+4wz//6qy8JxjZsmxxy5+4w9CDNJY09T072iKG0EnOS0arEYgXqYnXcYHwjTtUNAcMelOd4xpkoqiTYICWFq0JSiPfPDQdnt+4/wuqcXY47QILbgAAAABJRU5ErkJggg==)",s.style.opacity="0.05",s.style.pointerEvents="none",t.appendChild(s);const i=document.createElement("h2");i.textContent=a.resources.i18n.get("menu.selectLevel"),i.style.color="#faf0dc",i.style.textAlign="center",i.style.margin="0 0 15px 0",i.style.fontFamily="Arial, sans-serif",i.style.fontSize="24px",i.style.textShadow="2px 2px 4px rgba(0, 0, 0, 0.7)",i.style.position="relative",i.style.zIndex="2",t.appendChild(i);const o=document.createElement("button");o.innerHTML="&times;",o.style.position="absolute",o.style.top="10px",o.style.right="10px",o.style.background="rgba(150, 80, 30, 0.7)",o.style.border="2px solid #fbefd5",o.style.borderRadius="50%",o.style.color="#faf0dc",o.style.fontSize="20px",o.style.cursor="pointer",o.style.width="30px",o.style.height="30px",o.style.display="flex",o.style.justifyContent="center",o.style.alignItems="center",o.style.boxShadow="0 2px 4px rgba(0,0,0,0.5)",o.style.zIndex="2",o.title=a.resources.i18n.get("buttons.close"),o.onclick=()=>{document.body.removeChild(e)},o.onmouseover=()=>{o.style.background="rgba(180, 100, 40, 0.9)",o.style.transform="scale(1.05)"},o.onmouseout=()=>{o.style.background="rgba(150, 80, 30, 0.7)",o.style.transform="scale(1)"},t.appendChild(o);const n=document.createElement("div");n.style.position="relative",n.style.zIndex="2",n.style.backgroundColor="rgba(0,0,0,0.1)",n.style.borderRadius="8px",n.style.padding="15px",n.style.boxShadow="inset 0 0 5px rgba(0,0,0,0.3)";const r=document.createElement("div"),l=a.levelsData.length;let d=5;l>25?d=8:l>15&&(d=6),r.style.display="grid",r.style.gridTemplateColumns=`repeat(${d}, 1fr)`,r.style.gap="8px";for(let m=0;m<l;m++){const f=document.createElement("div");f.style.position="relative",f.style.width="100%",f.style.paddingBottom="100%";const g=document.createElement("div");g.textContent=(m+1).toString(),g.style.position="absolute",g.style.top="0",g.style.left="0",g.style.width="100%",g.style.height="100%",g.style.display="flex",g.style.justifyContent="center",g.style.alignItems="center",g.style.fontSize="16px",g.style.fontWeight="bold",g.style.color="#faf0dc",g.style.textShadow="1px 1px 1px #000";const p=m===a.currentLevel;g.style.backgroundColor=p?"#8B4513":"#654321",g.style.backgroundImage="linear-gradient(to bottom, rgba(255,255,255,0.1) 0%, rgba(0,0,0,0.1) 100%)",g.style.border=p?"2px solid #ffd700":"2px solid #8B4513",g.style.borderRadius="6px",g.style.boxShadow="0 2px 4px rgba(0,0,0,0.4)",g.style.cursor="pointer",g.style.transition="all 0.15s ease-in-out",f.appendChild(g),f.onmouseover=()=>{g.style.transform="translateY(-2px)",g.style.boxShadow="0 4px 8px rgba(0,0,0,0.5)",g.style.backgroundColor=p?"#9B5523":"#755431"},f.onmouseout=()=>{g.style.transform="translateY(0)",g.style.boxShadow="0 2px 4px rgba(0,0,0,0.4)",g.style.backgroundColor=p?"#8B4513":"#654321"},f.onmousedown=()=>{g.style.transform="translateY(1px)",g.style.boxShadow="0 1px 2px rgba(0,0,0,0.5)"},f.onmouseup=()=>{g.style.transform="translateY(-2px)",g.style.boxShadow="0 4px 8px rgba(0,0,0,0.5)"},f.onclick=()=>{a.setCurrentLevel(m),a.changeLevel(m),document.body.removeChild(e)},r.appendChild(f)}n.appendChild(r),t.appendChild(n),e.appendChild(t),document.body.appendChild(e);const u=m=>{m.key==="Escape"&&(document.body.removeChild(e),document.removeEventListener("keydown",u))};document.addEventListener("keydown",u)}function ye(){E.ENABLED=!E.ENABLED,E.ENABLED?(E.SHOW_TILE_NUMBERS=!0,E.SHOW_COORDINATES=!0,xe()):(E.SHOW_TILE_NUMBERS=!1,E.SHOW_COORDINATES=!1,we()),console.log(`Debug mode ${E.ENABLED?"enabled":"disabled"}`)}function xe(){let a=document.getElementById("debug-panel");if(a)a.style.display="block";else{a=document.createElement("div"),a.id="debug-panel",a.style.position="absolute",a.style.top="60px",a.style.right="10px",a.style.backgroundColor="rgba(0, 0, 0, 0.7)",a.style.padding="10px",a.style.borderRadius="5px",a.style.color="white",a.style.fontFamily="monospace",a.style.fontSize="12px",a.style.zIndex="1000",a.style.minWidth="200px",a.style.textAlign="left";const e=document.createElement("div");e.textContent="DEBUG MODE",e.style.fontWeight="bold",e.style.marginBottom="5px",e.style.textAlign="center",e.style.borderBottom="1px solid #666",e.style.paddingBottom="5px",a.appendChild(e);const t=z("SHOW_TILE_NUMBERS","Show Tile Numbers"),s=z("SHOW_COORDINATES","Show Coordinates");a.appendChild(t),a.appendChild(s);const i=document.createElement("div");i.style.marginTop="10px",i.style.fontSize="10px",i.style.color="#aaa",i.textContent="Toggle Debug Mode: Ctrl+D",a.appendChild(i),document.getElementById("mainContent").appendChild(a)}Se()}function z(a,e){const t=document.createElement("div");t.style.margin="5px 0";const s=document.createElement("input");s.type="checkbox",s.id=`debug-${a}`,s.checked=E[a],s.addEventListener("change",()=>{E[a]=s.checked});const i=document.createElement("label");return i.htmlFor=`debug-${a}`,i.textContent=` ${e}`,t.appendChild(s),t.appendChild(i),t}function Se(){const a=document.getElementById("debug-SHOW_TILE_NUMBERS"),e=document.getElementById("debug-SHOW_COORDINATES");a&&(a.checked=E.SHOW_TILE_NUMBERS),e&&(e.checked=E.SHOW_COORDINATES)}function we(){const a=document.getElementById("debug-panel");a&&(a.style.display="none")}class Ee{constructor(e){this.canvas=e,this.canvas.width=A.WIDTH,this.canvas.height=A.HEIGHT,this.ctx=e.getContext("2d"),this.resources=new ge,this.stars3d=new V(this.ctx,A.WIDTH,A.HEIGHT,130,2,64),this.player=null,this.boxes=null,this.level=null,this.goal=null,this.score=null,this.levelsData=null,this.levelData=null,this.currentLevel=0,this.lastKeyPressTime=0,this.keyThrottleDelay=N.KEY_THROTTLE_DELAY,this.state=c.LOADING,this.settings={movementSpeed:N.DEFAULT_SPEED,soundEnabled:!0,musicEnabled:!0},this.animationFrameId=null,this.loadingProgress=0,this.loadingProgressBar=this._createLoadingProgressBar(),this.logoAnimationStartTime=Date.now(),this.logoAnimationDuration=1500,this.languageSelector=null,document.title=this.resources.i18n.get("title"),this.resources.i18n.onLanguageChange=()=>{this.updateAllTexts()}}_createLoadingProgressBar(){const e=document.createElement("div");e.id="loading-progress-container",e.style.position="absolute",e.style.top="70%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.width="300px",e.style.height="20px",e.style.backgroundColor="#333",e.style.borderRadius="10px",e.style.overflow="hidden",e.style.zIndex="100";const t=document.createElement("div");return t.id="loading-progress-bar",t.style.width="0%",t.style.height="100%",t.style.backgroundColor="#4CAF50",t.style.transition="width 0.3s",e.appendChild(t),document.getElementById("mainContent").appendChild(e),e}updateAllTexts(){document.title=this.resources.i18n.get("title"),this.score&&this.score.updateTexts(this.resources.i18n),this.draw()}createLanguageSelector(){this.languageSelector=document.createElement("div"),this.languageSelector.id="language-selector",this.languageSelector.className="language-selector",this.languageSelector.style.position="absolute",this.languageSelector.style.top="10px",this.languageSelector.style.right="10px",this.languageSelector.style.backgroundColor="rgba(0, 0, 0, 0.5)",this.languageSelector.style.padding="5px",this.languageSelector.style.borderRadius="5px",this.languageSelector.style.zIndex="100";const e=document.createElement("select");e.id="language-select",e.style.padding="4px",e.style.paddingLeft="28px",e.style.backgroundColor="#333",e.style.color="white",e.style.border="1px solid #666",e.style.borderRadius="3px",e.style.backgroundSize="20px auto",e.style.backgroundRepeat="no-repeat",e.style.backgroundPosition="4px center";const t=this.resources.i18n.getLanguages();for(const s in t){const i=document.createElement("option");i.value=s,i.textContent=t[s].name,i.dataset.flag=t[s].flag,s===this.resources.i18n.getCurrentLanguage()&&(i.selected=!0,e.style.backgroundImage=`url(${t[s].flag})`),e.appendChild(i)}return e.addEventListener("change",s=>{const o=s.target.options[s.target.selectedIndex].dataset.flag;e.style.backgroundImage=`url(${o})`,this.resources.i18n.setLanguage(s.target.value)}),this.languageSelector.appendChild(e),document.getElementById("mainContent").appendChild(this.languageSelector),this.languageSelector}init(){this._setupResizeHandler(),this.resources.loadAll(this.updateLoadingProgress.bind(this)).then(()=>this.loadLevels()).then(()=>{this.setupGame(),me(this),pe(),this._hideLoadingProgressBar(),this.startIdleCheck(),this.startGameLoop(),this.createLanguageSelector()}).catch(e=>{console.error("Error during game initialization:",e),this.showErrorMessage(e)})}_setupResizeHandler(){this._resizeCanvas(),window.addEventListener("resize",()=>{this._resizeCanvas(),this.level&&this.level.initLevel()})}_resizeCanvas(){const e=this.canvas.parentElement;if(!e)return;const t=A.WIDTH,s=A.HEIGHT,i=t/s;let o=e.clientWidth,n=e.clientHeight;o/n>i?o=n*i:n=o/i,this.canvas.style.width=`${o}px`,this.canvas.style.height=`${n}px`,this.stars3d&&(this.stars3d.centerX=Math.floor(this.canvas.width/2),this.stars3d.centerY=Math.floor(this.canvas.height/2))}updateLoadingProgress(e){this.loadingProgress=e;const t=document.getElementById("loading-progress-bar");t&&(t.style.width=`${e}%`),console.log(`Loading: ${e}%`)}_hideLoadingProgressBar(){this.loadingProgressBar&&this.loadingProgressBar.parentNode&&(this.loadingProgressBar.style.opacity="0",this.loadingProgressBar.style.transition="opacity 0.5s",setTimeout(()=>{this.loadingProgressBar.parentNode&&this.loadingProgressBar.parentNode.removeChild(this.loadingProgressBar)},500))}loadLevels(){return fetch(v.LEVELS).then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()}).then(e=>(this.levelsData=JSON.parse(JSON.stringify(e)),this.levelData=JSON.parse(JSON.stringify(this.levelsData[this.currentLevel])),e))}startGameLoop(){const e=()=>{this.draw(),this.animationFrameId=requestAnimationFrame(e)};e()}startIdleCheck(){setInterval(()=>this.checkPlayerIdle(),1e3)}draw(){switch(this.prepareScreen(),this.state){case c.LOADING:this.showLoadingScreen();break;case c.INTRO:this.showIntroScreen();break;case c.PLAY:this.renderGameElements();break;case c.WIN:this.renderGameElements(),this.showWinningLevelScreen();break;case c.PAUSED:this.renderGameElements(),this.showPauseScreen();break}}renderGameElements(){var e,t,s,i,o;this.resources.images&&this.resources.images.levelBackground&&this.resources.images.levelBackground.image&&this.ctx.drawImage(this.resources.images.levelBackground.image,0,0,this.canvas.width,this.canvas.height),(e=this.level)==null||e.draw(),(t=this.goal)==null||t.draw(),(s=this.boxes)==null||s.draw(),(i=this.player)==null||i.draw(),(o=this.score)==null||o.draw(),this.drawCornerLogo()}drawCornerLogo(){if(this.resources.images&&this.resources.images.logo&&this.resources.images.logo.image){const e=this.resources.images.logo.image,t=10,s=100,i=e.width/e.height,o=s*i,n=s;this.ctx.save(),this.ctx.globalAlpha=.3,this.ctx.drawImage(e,t+2,t+2,o,n),this.ctx.globalAlpha=.8,this.ctx.drawImage(e,t,t,o,n),this.ctx.restore()}}prepareScreen(){const e=this.ctx.createLinearGradient(0,0,0,this.ctx.canvas.height);e.addColorStop(0,A.BACKGROUND_COLOR),e.addColorStop(1,A.BACKGROUND_COLOR),this.ctx.fillStyle=e,this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}showLoadingScreen(){this.ctx.fillStyle="#000000",this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.stars3d.draw();const e=this.ctx.canvas.width/2,t=this.ctx.canvas.height/2;if(this.resources.images&&this.resources.images.logo&&this.resources.images.logo.image){const i=this.resources.images.logo.image,o=i.width,n=i.height,r=Date.now()-this.logoAnimationStartTime,l=Math.min(r/this.logoAnimationDuration,1),d=this._easeOutBack(l),u=.5+.5*d,m=d;this.ctx.save(),this.ctx.globalAlpha=m;const f=o*u,g=n*u;this.ctx.drawImage(i,e-f/2,t-g/2,f,g),this.ctx.restore()}else this.ctx.font="30px Arial",this.ctx.textAlign="center",this.ctx.fillStyle="white",this.ctx.fillText(this.resources.i18n.get("loading.title"),e,t-20);const s=t+200;this.ctx.font="20px Arial",this.ctx.textAlign="center",this.ctx.fillStyle="black",this.ctx.fillText(this.resources.i18n.get("loading.preparing"),e,s),this.ctx.fillStyle="white",this.ctx.fillText(this.resources.i18n.get("loading.preparing"),e-2,s-2)}_easeOutBack(e){return 1+2.70158*Math.pow(e-1,3)+1.70158*Math.pow(e-1,2)}showIntroScreen(){this.ctx.drawImage(this.resources.images.main.image,0,0,this.canvas.width,this.canvas.height),this.ctx.textAlign="center",this.ctx.font="20px Arial";const e=this.resources.images.logo.image,t=e.width,s=e.height,i=Date.now()*.01;for(let p=0;p<s;p++){const x=Math.sin(p*.05+i)*5+(this.ctx.canvas.width/2-t/2);this.ctx.drawImage(e,0,p,t,1,x,p+-20,t,1)}const o=this.resources.images.btnPlay.image,n=this.ctx.canvas.width/2-o.width/2,r=this.canvas.height*.8;this.ctx.drawImage(o,n,r);const l=this.resources.i18n.get("buttons.play").toUpperCase();let d=30;l.length>10&&(d=24),l.length>15&&(d=20),this.ctx.font=`bold ${d}px Arial`;const u=r+o.height/2+10,m=this.ctx.canvas.width/2;this.ctx.fillStyle="rgba(0,0,0,0.7)",this.ctx.fillText(l,m+2,u+2),this.ctx.fillStyle="white",this.ctx.fillText(l,m,u),this.ctx.font="10px Arial",this.ctx.textAlign="right";const f=this.canvas.width-10,g=this.canvas.height-10;this.ctx.fillStyle="black",this.ctx.fillText(`© ${F} / Version: ${_}`,f+1,g+1),this.ctx.fillStyle="white",this.ctx.fillText(`© ${F} / Version: ${_}`,f,g)}showWinningLevelScreen(){this.ctx.font="30px Arial",this.ctx.textAlign="center",this.ctx.fillStyle="black";const e=this.ctx.canvas.width/2,t=this.ctx.canvas.height/2;this.ctx.fillText(this.resources.i18n.get("game.victory"),e,t),this.ctx.fillStyle="white",this.ctx.fillText(this.resources.i18n.get("game.victory"),e-3,t-3),this.ctx.font="15px Arial",this.ctx.textAlign="center",this.ctx.fillStyle="black",this.ctx.fillText(this.resources.i18n.get("game.nextLevel"),e,t+30),this.ctx.fillStyle="white",this.ctx.fillText(this.resources.i18n.get("game.nextLevel"),e-3,t-3+30)}showPauseScreen(){this.ctx.fillStyle="rgba(0, 0, 0, 0.5)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);const e=this.ctx.canvas.width/2,t=this.ctx.canvas.height/2-100;this.ctx.font="30px Arial",this.ctx.textAlign="center",this.ctx.fillStyle="white",this.ctx.fillText(this.resources.i18n.get("settings.paused"),e,t),this.ctx.font="20px Arial",this.ctx.fillText(this.resources.i18n.get("settings.movementSpeed")||"Movement Speed",e,t+60),this._drawSpeedButtons(e,t+100),this.ctx.font="16px Arial",this.ctx.fillText(this.resources.i18n.get("settings.resumeHint"),e,t+180)}_drawSpeedButtons(e,t){const r=e-230,l=[{key:"SLOW",label:this.resources.i18n.get("speeds.slow")||"Slow"},{key:"NORMAL",label:this.resources.i18n.get("speeds.normal")||"Normal"},{key:"FAST",label:this.resources.i18n.get("speeds.fast")||"Fast"},{key:"VERY_FAST",label:this.resources.i18n.get("speeds.veryFast")||"Very Fast"}];this.ctx.font="16px Arial",this.ctx.textAlign="center",this.speedButtons?this.speedButtons.length=0:this.speedButtons=[];for(let d=0;d<l.length;d++){const u=r+d*120,m=l[d],f=this.settings.movementSpeed===m.key;this.speedButtons.push({x:u,y:t,width:100,height:40,value:m.key}),this.ctx.fillStyle=f?"#4CAF50":"#555555",this.ctx.fillRect(u,t,100,40),this.ctx.strokeStyle=f?"#FFFFFF":"#888888",this.ctx.lineWidth=f?2:1,this.ctx.strokeRect(u,t,100,40),this.ctx.fillStyle="white",this.ctx.fillText(m.label,u+100/2,t+40/2+6)}}showErrorMessage(e){const t=this.ctx.canvas.width/2,s=this.ctx.canvas.height/2+120;this.ctx.font="16px Arial",this.ctx.fillStyle="red",this.ctx.fillText(this.resources.i18n.get("error.loading"),t,s)}setupGame(){this.player=null,this.boxes=null,this.level=null,this.goal=null,this.score=null;const e=I.OUTPUT_SIZE;this.player=new Z(this.ctx,this.resources.images.player.image,I.PLAYER_SOURCE_SIZE,e,I.PLAYER_EXTRA_SIZE),this.level=new J(this.ctx,this.resources.images.tiles.image,I.SOURCE_SIZE,e),this.boxes=new K(this.ctx,this.resources.images.tiles.image,I.SOURCE_SIZE,e),this.goal=new $(this.ctx,this.resources.images.tiles.image,I.SOURCE_SIZE,e),this.score=new Q(this.ctx,this.resources),this.score.level=this.currentLevel+1}canProcessKeyPress(){const e=Date.now();return e-this.lastKeyPressTime>=this.keyThrottleDelay?(this.lastKeyPressTime=e,!0):!1}setState(e){return X[this.state].includes(e)?(this._exitState(this.state),this._enterState(e),this.state=e,!0):(console.warn(`Invalid state transition: ${this.state} -> ${e}`),!1)}_exitState(e){var t;switch(e){case c.PLAY:(t=this.score)==null||t.stopTimer();break;case c.INTRO:this.resources.sound.music.pause(),this.resources.sound.music.currentTime=0;break;case c.WIN:this.resources.sound.victory.pause();break}}_enterState(e){switch(e){case c.PLAY:break;case c.INTRO:this.resources.playBackgroundMusic(!0);break;case c.WIN:this.resources.playSound("victory");break}}togglePause(){this.state===c.PLAY?this.setState(c.PAUSED):this.state===c.PAUSED&&this.setState(c.PLAY)}setCurrentLevel(e){this.currentLevel=e}restartLevel(){this.changeLevel(this.currentLevel)}changeLevel(e){this.levelData=JSON.parse(JSON.stringify(this.levelsData[e])),this.currentLevel=e,this.setupGame(),this.state=c.PLAY,this.boxes&&this.boxes.updateBoxesScore()}checkPlayerIdle(){this.state===c.PLAY&&this.player&&Date.now()-this.player.idle>3e4&&(this.player.idleDetector(),this.player.idle=Date.now())}checkLevelComplete(){if(this.boxes.boxes.length!==this.goal.goals.length)return console.error("Number of boxes doesn't match number of goals!"),!1;let e=0;for(const t of this.boxes.boxes)for(const s of this.goal.goals)if(t.x===s.x&&t.y===s.y){e++;break}return e===this.goal.goals.length?(this.setState(c.WIN),this.resources.sound.victory.currentTime=0,this.resources.sound.victory.play(),!0):!1}isMobileDevice(){return/iPhone|iPad|iPod|Android|webOS|BlackBerry|Windows Phone/i.test(navigator.userAgent)}getMovementDuration(){return N.MOVEMENT_SPEEDS[this.settings.movementSpeed]}setMovementSpeed(e){N.MOVEMENT_SPEEDS[e]&&(this.settings.movementSpeed=e,this.player&&(this.player.movementDuration=this.getMovementDuration()),this.boxes&&(this.boxes.movementDuration=this.getMovementDuration()))}}let h;document.addEventListener("DOMContentLoaded",function(){const a=document.getElementById("mainCanvas");h=new Ee(a),h.init()});h&&h.resources;h&&(Object.defineProperty(T,"gameState",{get:()=>h.state}),Object.defineProperty(T,"currentLevel",{get:()=>h.currentLevel}),Object.defineProperty(T,"levelData",{get:()=>h.levelData}),Object.defineProperty(T,"levelsData",{get:()=>h.levelsData}),Object.defineProperty(T,"player",{get:()=>h.player}),Object.defineProperty(T,"boxes",{get:()=>h.boxes}),Object.defineProperty(T,"goal",{get:()=>h.goal}),Object.defineProperty(T,"level",{get:()=>h.level}),Object.defineProperty(T,"score",{get:()=>h.score}));document.addEventListener("DOMContentLoaded",function(){const a=document.getElementById("mainCanvas");a?(a.width=A.WIDTH,a.height=A.HEIGHT,console.log(`Canvas dimensions set to ${A.WIDTH}x${A.HEIGHT} from config`)):console.error('Canvas element not found! Check if the HTML includes an element with id="mainCanvas"')});console.log("Sokoban game initialized")});export default be();
